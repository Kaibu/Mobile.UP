<ion-header>
  <ion-toolbar>
    <ion-back-button slot="start"></ion-back-button>
    <ion-menu-button slot="end"></ion-menu-button>
    <ion-title>{{ "page.mensa.title" | translate }}</ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <app-campus-tab (campusChanged)="changeCampus($event)"></app-campus-tab>
  </ion-toolbar>
</ion-header>

<ion-content no-padding (swipe)="campusTabComponent.handleSwipeEvent($event)">
  <ion-refresher slot="fixed" (ionRefresh)="loadCampusMenu($event)">
    <ion-refresher-content pullingIcon="refresh" refreshingSpinner="dots"></ion-refresher-content>
  </ion-refresher>

  <div align="center" *ngIf="!isLoaded" padding>
    <ion-spinner name="dots"></ion-spinner>
  </div>

  <app-hint-box *ngIf="isLoaded && !mensaIsOpen && !networkError" hintTypeI18nKey="hints.type.hint" hintTextI18nKey="page.mensa.mensaClosed"></app-hint-box>

  <ion-item *ngIf="isLoaded" lines="none" style="--padding-start: 5px; font-size: 0.95em;">
    <ion-chip slot="start" outline="true" (click)="showBasicCalendar = !showBasicCalendar;">
      <ion-icon name="calendar"></ion-icon>
      {{ "page.mensa.date" | translate }}
    </ion-chip>
    <ion-label>Filter</ion-label>
    <ion-select multiple="true" (ionChange)="filterMenus($event)" okText="{{ 'button.ok' | translate }}" cancelText="{{ 'button.cancel'  | translate }}">
      <ion-select-option *ngFor="let filter of filterKeywords">{{ filter }}</ion-select-option>
    </ion-select>
  </ion-item>

  <ion-calendar *ngIf="showBasicCalendar" [(ngModel)]="date"
  (change)="pickDate($event)"
  [options]="optionsBasic"
  [type]="type"
  [format]="'YYYY-MM-DD'">
  </ion-calendar>

  <div *ngIf="isLoaded">
    <ion-list lines="none" [ngClass]="showBasicCalendar ? 'calendarExpanded' : 'calendarCollapsed' ">
      <app-mensa-meal *ngIf="!noMealsForDate"
      [meals]="displayedMeals"
      [mealForDate]="mealForDate"
      [iconMapping]="iconMapping"></app-mensa-meal>

      <ion-item-divider *ngIf="ulfMeals && !noUlfMealsForDate" color="light">
        <ion-label>
          Ulf's CafÃ©
        </ion-label>
      </ion-item-divider>

      <app-mensa-meal *ngIf="ulfMeals && !noUlfMealsForDate"
      [meals]="displayedUlfMeals"
      [mealForDate]="ulfMealForDate"
      [iconMapping]="ulfIconMapping"></app-mensa-meal>
    </ion-list>
  </div>

  <div *ngIf="(isLoaded && !hardRefresh) && noMealsForDate && noUlfMealsForDate && !networkError && mensaIsOpen">
    <app-hint-box hintTypeI18nKey="hints.type.hint" hintTextI18nKey="hints.text.mensa-nomeals-hint"></app-hint-box>
  </div>
  <app-hint-box *ngIf="isLoaded && networkError" hintTypeI18nKey="alert.title.httpError" hintTextI18nKey="alert.network"></app-hint-box>

</ion-content>

<ion-footer>
  <ion-toolbar>
    <app-footer-disclaimer disclaimerReference="page.mensa.disclaimer"></app-footer-disclaimer>
  </ion-toolbar>
</ion-footer>
